<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ugle Search</title>
    <link rel="stylesheet" href="results.css"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300&family=Roboto:wght@300&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style> 
    body{
    font-family: 'Montserrat', sans-serif;
    font-family: 'Roboto', sans-serif;
}
#main{
    display: flex;
    flex-direction: row;
    margin: auto;
}
#headerstyles{
    width: 100%;
   height: 5rem;
}
#logo{
width: 120px;
position: absolute;
left: 32px;
margin-top: 8px;
}

input{
width: 40%;
margin-top: 1.5rem;
margin-left: 11rem;
height: 34px;
border-radius: 25px;
border-width: 1px;
border-color: #CCC;
padding-left: 1.5rem;
caret-color: #525252;
font-weight: 540;
color: #3d3d3d;
}

input:focus{
    outline: none;
}

.totalResult{margin-left: 12rem;font-size: 14px;color:rgb(62, 62, 62)}
.result{
    max-width: 640px;
    margin-left: 12rem;
    font-weight: 500;
}
.result h3{
    color: #0364b9;
    margin-bottom: 4px;
}
.result span{
    color:rgb(25, 25, 25)
}

#inputContent{
    position: relative;
}

#searchIcon{
    position: absolute;
    top:2rem;
    left:48rem;
    color:#0364b9
}
#searchIcon {
    cursor: pointer;
}
#searchIcon:hover{
    cursor: pointer;
    transform: scale(1.1);
    transition: all;
    transition-duration: 0.1s;
}
#items-list{
list-style: none;
}
   </style>

</head>
<body>
    <div id="main">
        <div id='headerstyles'>
            <img id="logo" src="img/logo.png" alt="logo">
            <div id="inputContent">
                <input id="txtSearch" type="text">
                  <i id="searchIcon" class="material-icons" style="font-size: 25px;">search</i>
            </div>
        </input>
        </div>   
    </div>
    <hr/> 
    <div id="results">
        <div id="count"></div>
    </div>
    <div id="pagination-container">
        <ul id="items-list">
          <!-- Aquí se mostrarán los elementos de la página actual -->
        </ul>
        <div id="pagination">
          <!-- Aquí se mostrarán los enlaces de paginación -->
        </div>
      </div>
    <script>
        let aux = document.location.href.split("?query=");
        let query = aux[1].replace(/\%20/g," ")
        let inputValue=document.getElementById("txtSearch").value = query;
        let count = 0;
        const itemsPerPage = 6;
        const items = [];
        let totalPage;
        let itemsList;

        function performSearch(query,page){
            fetch("http://localhost:8080/api/search?query="+query)
        .then(response=>  response.json())
        .then(json=>{
            console.log("entre")
        let html = "";
        for(let resultSearch of json){
        count++
        items.push(getHtmlResultSearch(resultSearch))
       // html += getHtmlResultSearch(resultSearch);
        }
        document.getElementById("count").outerHTML = `<span class="totalResult">Cerca de ${count} resultados (0.42 segundos)</span>`//seguir desde aca
        updatePagination();
        displayItems(page);
        //document.getElementById("links").outerHTML = html;
        }
    )}

        function getHtmlResultSearch(resultSearch){
            return ` <div class="result">
            <h3><a href="${resultSearch.url}" target="_blank">${resultSearch.title}</a></h3>
            <span>${resultSearch.description}</span>
        </div>`
        }

    document.addEventListener("DOMContentLoaded", function () {
   
    document.addEventListener("keyup", function (event) {
        if (event.key === "Enter" && event.target.id === "txtSearch") {
            miFuncion();
        }
    });

    document.getElementById("searchIcon").addEventListener("click", function(event) {
        miFuncion();
    });

    function miFuncion() {
        let inputQuery = document.getElementById("txtSearch");
        let query = inputQuery.value;
        document.location.href = 'results.html?query=' + encodeURIComponent(query);
    }
});

    //Pagination
    function displayItems(pageNumber){
       startIndex = (pageNumber - 1) * itemsPerPage;
       endIndex = startIndex + itemsPerPage;
       const itemsToDisplay = items.slice(startIndex,endIndex);

       itemsList = document.getElementById("items-list");
       itemsList.innerHTML = '';
        itemsToDisplay.forEach(item=>{
            const li = document.createElement('li');
            li.innerHTML = item;
            itemsList.appendChild(li);
        })
    }

    //pagination buttons and call
    function updatePagination(){
        totalPage = Math.ceil(count / itemsPerPage);
        const pagination = document.getElementById("items-list");
        pagination.innerHTML = "";
    }
        for(let i = 0; i < totalPage; i++){
            const button = document.createElement("button");
            button.textContent = i;
            button.addEventListener("click",()=>{
                performSearch(query, i);
            });
            pagination.appendChild(button);
        }

    performSearch(query, 1);
    </script>
</body>
</html>